<%= bootstrap_form_for @feedback_form, :url => url_for_form(@user_application, @feedback_form) do |f|  %>

  <%= f.form_group class: 'col-lg-12' do %>
  <%= f.error_summary %>
  <%= f.text_field :name %>
  <% end %>

  <%= f.form_group class: 'col-lg-12', label: {text: 'Campos do FormulÃ¡rio'} do %>
    <table class='sorted_table table-responsive table-bordered table'>
      <thead>
        <tr>
          <th>Tipo</th>
          <th>Nome</th>
          <th>Label</th>
          <th>Options</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
        <% @feedback_form.feedback_attributes.all.sort(position: 1).each do |attribute| %>
          <%= f.fields_for_with_bootstrap :feedback_attributes, attribute do |attribute_form| %>
            <tr>
              <td>
                <%= attribute_form.hidden_field 'position', :class => 'position' %>
                <%= render :partial => "feedback_forms/attribute_types/#{attribute.type.name.downcase}" %>
              </td>
              <td><%= attribute.name %></td>
              <td><%= attribute.label %></td>
              <td>
                <%= attribute.custom_data["options"].join(',') if attribute.custom_data and  attribute.custom_data["options"]%>
              </td>
              <td>
                <%= attribute.custom_data["value"] if attribute.custom_data.present? and attribute.custom_data["value"] %>
              </td>
            </tr>
          <% end %>
        <% end %>
      <tbody>
      </table>
  <% end %>

  <%= f.form_group class: 'col-lg-4' do %>
    <%= f.collection_check_boxes :grid_columns, @feedback_form.feedback_attributes, :name, :label %>
  <% end %>

  <%= f.form_group class: 'col-lg-4' do %>
    <%= f.collection_check_boxes :detail_columns, @feedback_form.feedback_attributes, :name, :label %>
  <% end %>

  <%= f.form_group class: 'col-lg-4', label: {text: t('feedback_form.form_group.plugins') }  do %>
    <%= f.check_box :screenshot_enabled, label: 'ScreenShot' %>
    <%= f.check_box :review_enabled, label: 'Review' %>
  <% end %>

  <%= f.form_group :class => 'col-lg-12' do %>
    <%= f.primary t('Submit')  %>
    <%= link_to t('Cancel'), './', :class => 'btn btn-warning'  %>
  <% end %>
<% end %>

<script type='text/javascript'>

$(document).on('ready page:load',function(){
  $('.sorted_table').sortable({
    containerSelector: 'table',
    itemPath: '> tbody',
    itemSelector: 'tr',
     placeholder: '<tr class="placeholder"/>',
     onDrop: function(){
       $('.sorted_table tr input.position').each(function(index){
         $(this).val(index);
       });
     }
  });
});

</script>
